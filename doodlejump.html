<!DOCTYPE html>
<html>
<head>
    <title>Basic Doodle Jump HTML Game</title>
    <meta charset="UTF-8">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        canvas {
            border: 1px solid black;
        }

        #deathScreen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding-top: 200px;
            font-size: 32px;
        }

        #restartButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<canvas width="375" height="667" id="game"></canvas>
<div id="deathScreen">
    <div>Game Over!</div>
    <button id="restartButton">Restart</button>
</div>

<script>
const canvas = document.getElementById('game');
const context = canvas.getContext('2d');

let isGameActive = true; // Track if the game is active
let eventHandlers = [];

// width and height of each platform and where platforms start
const platformWidth = 65;
const platformHeight = 20;
const platformStart = canvas.height - 50;

// player physics
const gravity = 0.33;
const drag = 0.3;
const bounceVelocity = -12.5;

// minimum and maximum vertical space between each platform
let minPlatformSpace = 15;
let maxPlatformSpace = 20;

// information about each platform. the first platform starts in the
// bottom middle of the screen
let platforms = [{
    x: canvas.width / 2 - platformWidth / 2,
    y: platformStart
}];

// get a random number between the min (inclusive) and max (exclusive)
function random(min, max) {
    return Math.random() * (max - min) + min;
}

// fill the initial screen with platforms
let y = platformStart;
while (y > 0) {
    y -= platformHeight + random(minPlatformSpace, maxPlatformSpace);
    let x;
    do {
        x = random(25, canvas.width - 25 - platformWidth);
    } while (
        y > canvas.height / 2 &&
        x > canvas.width / 2 - platformWidth * 1.5 &&
        x < canvas.width / 2 + platformWidth / 2
    );

    platforms.push({ x, y });
}

// the doodle jumper
const doodle = {
    width: 40,
    height: 60,
    x: canvas.width / 2 - 20,
    y: platformStart - 60,

    // velocity
    dx: 0,
    dy: 0
};

// keep track of player direction and actions
let playerDir = 0;
let keydown = false;
let prevDoodleY = doodle.y;

// game loop
function loop() {
    if (!isGameActive) return; // Stop the game if it's not active
    
    requestAnimationFrame(loop);
    context.clearRect(0, 0, canvas.width, canvas.height);

    // apply gravity to doodle
    doodle.dy += gravity;

    if (doodle.y < canvas.height / 2 && doodle.dy < 0) {
        platforms.forEach(function (platform) {
            platform.y += -doodle.dy;
        });

        while (platforms[platforms.length - 1].y > 0) {
            platforms.push({
                x: random(25, canvas.width - 25 - platformWidth),
                y: platforms[platforms.length - 1].y - (platformHeight + random(minPlatformSpace, maxPlatformSpace))
            });

            minPlatformSpace += 0.5;
            maxPlatformSpace += 0.5;
            maxPlatformSpace = Math.min(maxPlatformSpace, canvas.height / 2);
        }
    } else {
        doodle.y += doodle.dy;
    }

    if (!keydown) {
        if (playerDir < 0) {
            doodle.dx += drag;
            if (doodle.dx > 0) {
                doodle.dx = 0;
                playerDir = 0;
            }
        } else if (playerDir > 0) {
            doodle.dx -= drag;
            if (doodle.dx < 0) {
                doodle.dx = 0;
                playerDir = 0;
            }
        }
    }

    doodle.x += doodle.dx;

    if (doodle.x + doodle.width < 0) {
        doodle.x = canvas.width;
    } else if (doodle.x > canvas.width) {
        doodle.x = -doodle.width;
    }

    context.fillStyle = 'green';
    platforms.forEach(function (platform) {
        context.fillRect(platform.x, platform.y, platformWidth, platformHeight);

        if (
            doodle.dy > 0 &&
            prevDoodleY + doodle.height <= platform.y &&
            doodle.x < platform.x + platformWidth &&
            doodle.x + doodle.width > platform.x &&
            doodle.y < platform.y + platformHeight &&
            doodle.y + doodle.height > platform.y
        ) {
            doodle.y = platform.y - doodle.height;
            doodle.dy = bounceVelocity;
        }
    });

    context.fillStyle = 'yellow';
    context.fillRect(doodle.x, doodle.y, doodle.width, doodle.height);

    prevDoodleY = doodle.y;

    // Check if the doodle is off-screen
    if (doodle.y > canvas.height) {
        gameOver();
    }

    platforms = platforms.filter(function (platform) {
        return platform.y < canvas.height;
    });
}

// Game over function
function gameOver() {
    isGameActive = false; // End the game
    document.getElementById('deathScreen').style.display = "block"; // Show death screen
}

// Restart game function
function restartGame() {
    isGameActive = true; // Reset game state
    platforms = [{
        x: canvas.width / 2 - platformWidth / 2,
        y: platformStart
    }];
    doodle.x = canvas.width / 2 - 20;
    doodle.y = platformStart - 60;
    doodle.dy = 0;
    doodle.dx = 0;
    minPlatformSpace = 15;
    maxPlatformSpace = 20;
    prevDoodleY = doodle.y;
    document.getElementById('deathScreen').style.display = "none"; // Hide death screen
    requestAnimationFrame(loop); // Restart the game loop
}

// Listen to keyboard events to move doodle
document.addEventListener('keydown', function (e) {
    if (!isGameActive) return; // Prevent controlling the doodle if the game is over
    if (e.which === 37) {
        keydown = true;
        playerDir = -1;
        doodle.dx = -3;
    } else if (e.which === 39) {
        keydown = true;
        playerDir = 1;
        doodle.dx = 3;
    }
});

// Stop moving on key up
document.addEventListener('keyup', function (e) {
    if (e.which === 37 || e.which === 39) {
        keydown = false;
    }
});

// Restart button event handler
document.getElementById('restartButton').addEventListener('click', restartGame);

// Start the game
requestAnimationFrame(loop);
</script>
</body>
</html>
